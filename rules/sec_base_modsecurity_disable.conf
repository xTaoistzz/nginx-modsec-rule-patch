# ============================================================================
# ModSecurity Override Configuration - Nginx Compatible
# ============================================================================
# This configuration disables ALL base ModSecurity validation rules
# while keeping OWASP CRS fully functional.
#
# Compatible with: ModSecurity-nginx connector
# NOT compatible with: Apache ModSecurity (use different config)
#
# Include order:
# 1. modsecurity.conf
# 2. sec_base_modsecurity_disable.conf (THIS FILE)
# 3. owasp-crs/crs-setup.conf
# 4. owasp-crs/rules/*.conf
# ============================================================================


# ============================================================================
# Remove ALL existing base validation rules
# ============================================================================

#SecRuleRemoveById 200000
#SecRuleRemoveById 200001
SecRuleRemoveById 200002
SecRuleRemoveById 200003
SecRuleRemoveById 200004
SecRuleRemoveById 200005
#SecRuleRemoveById 200006
SecRuleRemoveById 200007
SecRuleRemoveById 200008


# ============================================================================
# Request Body Processing Configuration
# ============================================================================

SecRequestBodyAccess On
SecRequestBodyLimit 524288000
SecRequestBodyNoFilesLimit 10485760
SecRequestBodyLimitAction ProcessPartial
SecRequestBodyJsonDepthLimit 10000
SecArgumentsLimit 100000


# ============================================================================
# Content-Type Processors (Required for OWASP CRS)
# ============================================================================

#SecRule REQUEST_HEADERS:Content-Type "^(?:application(?:/soap\+|/)|text/)xml" \
#     "id:'200000',phase:1,t:none,t:lowercase,pass,nolog,ctl:requestBodyProcessor=XML"

#SecRule REQUEST_HEADERS:Content-Type "^application/json" \
#     "id:'200001',phase:1,t:none,t:lowercase,pass,nolog,ctl:requestBodyProcessor=JSON"

#SecRule REQUEST_HEADERS:Content-Type "^application/[a-z0-9.-]+[+]json" \
#     "id:'200006',phase:1,t:none,t:lowercase,pass,nolog,ctl:requestBodyProcessor=JSON"


# ============================================================================
# PCRE Performance Settings
# ============================================================================

SecPcreMatchLimit 1000000
SecPcreMatchLimitRecursion 1000000


# ============================================================================
# Response Body Processing
# ============================================================================

SecResponseBodyAccess On
SecResponseBodyLimit 52428800
SecResponseBodyLimitAction ProcessPartial
SecResponseBodyMimeType text/plain text/html text/xml application/json application/xml application/javascript text/javascript


# ============================================================================
# Filesystem Configuration
# ============================================================================

SecTmpDir /tmp/
SecDataDir /tmp/


# ============================================================================
# Audit Logging
# ============================================================================

SecAuditEngine RelevantOnly
SecAuditLogRelevantStatus "^(?:5|4(?!04))"
SecAuditLogParts ABFHZ
SecAuditLogType Serial
SecAuditLog /var/log/modsec_audit.log


# ============================================================================
# Miscellaneous Settings (Nginx-compatible only)
# ============================================================================

SecArgumentSeparator &
SecCookieFormat 0
SecUnicodeMapFile unicode.mapping 20127
SecStatusEngine Off

# NOTE: SecServerSignature is NOT supported in ModSecurity-nginx
# This directive only works with Apache ModSecurity
# For Nginx, configure server signature in nginx.conf using:
#   server_tokens off;


# ============================================================================
# Summary
# ============================================================================
# Base ModSecurity validation rules (200002-200007): DISABLED
# Content-type processors (200000, 200001, 200006): ENABLED
# OWASP CRS: FULLY FUNCTIONAL
# Security: 100% dependent on OWASP CRS
#
# IMPORTANT: Set OWASP CRS Paranoia Level to 2 or higher
# ============================================================================
